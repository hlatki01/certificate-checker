<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Payment Request Page</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body class="bg-gray-100 p-10">
    <div class="max-w-2xl mx-auto bg-white p-8 rounded-lg shadow">
        <h1 class="text-2xl font-semibold mb-6">Payment Request</h1>
        <form id="paymentForm" class="space-y-4">
            <div>
                <label for="xLogin" class="block font-medium">X-Login:</label>
                <input type="text" id="xLogin" name="xLogin" class="w-full p-2 border rounded" placeholder="API Login" />
            </div>
            <div>
                <label for="xTransKey" class="block font-medium">X-Trans-Key:</label>
                <input type="text" id="xTransKey" name="xTransKey" class="w-full p-2 border rounded" placeholder="Transaction Key" />
            </div>
            <div>
                <label for="country" class="block font-medium">Country:</label>
                <input type="text" id="country" name="country" class="w-full p-2 border rounded" placeholder="Country Code" />
            </div>
            <div>
                <label for="secretKey" class="block font-medium">Secret Key:</label>
                <input type="text" id="secretKey" name="secretKey" class="w-full p-2 border rounded" placeholder="Secret Key" />
            </div>
            <div>
                <label for="privateKeyFile" class="block font-medium">Private Key File:</label>
                <input type="file" id="privateKeyFile" name="privateKeyFile" class="w-full p-2 border rounded" accept=".pem" />
            </div>
            <div>
                <label for="certificateFile" class="block font-medium">Certificate File:</label>
                <input type="file" id="certificateFile" name="certificateFile" class="w-full p-2 border rounded" accept=".cer" />
            </div>
            <button type="button" onclick="sendPaymentRequest()" class="bg-blue-500 text-white px-4 py-2 rounded">Send Request</button>
        </form>
        <div id="response" class="mt-6"></div>
    </div>

    <script>
        async function sendPaymentRequest() {
            const xDate = new Date().toISOString();
            const xLogin = document.getElementById('xLogin').value;
            const xTransKey = document.getElementById('xTransKey').value;
            const country = document.getElementById('country').value;
            const secretKey = document.getElementById('secretKey').value;
            const privateKeyFile = document.getElementById('privateKeyFile').files[0];
            const certificateFile = document.getElementById('certificateFile').files[0];

            const apiURL = `https://sandbox-cert.dlocal.com/payments-methods?country=${country}`;
            const payload = { country };
            const concatenatedData = `${xLogin}${xDate}${JSON.stringify(payload)}`;
            const hashBytes = CryptoJS.HmacSHA256(concatenatedData, secretKey).toString();

            const headers = {
                'X-Date': xDate,
                'X-Login': xLogin,
                'X-Trans-Key': xTransKey,
                'Authorization': `V2-HMAC-SHA256, Signature: ${hashBytes}`
            };

            try {
                const privateKey = await privateKeyFile.text();
                const certificate = await certificateFile.text();

                const response = await axios.get(apiURL, {
                    headers,
                    httpsAgent: new https.Agent({
                        key: privateKey,
                        cert: certificate
                    })
                });

                document.getElementById('response').textContent = JSON.stringify(response.data, null, 2);
            } catch (error) {
                document.getElementById('response').textContent = 'Error: ' + error.message;
            }
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/crypto-js@4.1.1/crypto-js.js"></script>
</body>
</html>